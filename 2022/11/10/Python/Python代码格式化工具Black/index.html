<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Python代码格式化工具Black（转载） - Kurisu&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Kurisu&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Kurisu&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="作者：muzing 原文链接：https:&amp;#x2F;&amp;#x2F;muzing.top&amp;#x2F;posts&amp;#x2F;a29e4743&amp;#x2F;  良好的 Python 代码应有良好的格式规范（不止于遵守 PEP 8 ），使用一个更强大更专业的代码格式化工具，来替代编辑器自带的「格式化代码」功能是有一定必要的，这还可以使团队成员即使在不同编辑器下工作也可以得到完全相同的风格。相比于目前中文社区中较为流行的 autopep8，其实还有一个更好"><meta property="og:type" content="blog"><meta property="og:title" content="Python代码格式化工具Black（转载）"><meta property="og:url" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/"><meta property="og:site_name" content="Kurisu&#039;s Blog"><meta property="og:description" content="作者：muzing 原文链接：https:&amp;#x2F;&amp;#x2F;muzing.top&amp;#x2F;posts&amp;#x2F;a29e4743&amp;#x2F;  良好的 Python 代码应有良好的格式规范（不止于遵守 PEP 8 ），使用一个更强大更专业的代码格式化工具，来替代编辑器自带的「格式化代码」功能是有一定必要的，这还可以使团队成员即使在不同编辑器下工作也可以得到完全相同的风格。相比于目前中文社区中较为流行的 autopep8，其实还有一个更好"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923225124.jpg"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/python_black_logo.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925181843.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925224338.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210926212642.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925224800.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925225052.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205215.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205522.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210132.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205845.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210441.png"><meta property="og:image" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210902.png"><meta property="article:published_time" content="2022-11-10T08:36:32.000Z"><meta property="article:modified_time" content="2022-11-10T08:52:45.687Z"><meta property="article:author" content="Kurisu"><meta property="article:tag" content="Python"><meta property="article:tag" content="工具"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923225124.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/"},"headline":"Python代码格式化工具Black（转载）","image":["https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923225124.jpg","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/python_black_logo.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925181843.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925224338.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210926212642.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925224800.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925225052.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205215.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205522.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210132.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205845.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210441.png","https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210902.png"],"datePublished":"2022-11-10T08:36:32.000Z","dateModified":"2022-11-10T08:52:45.687Z","author":{"@type":"Person","name":"Kurisu"},"publisher":{"@type":"Organization","name":"Kurisu's Blog","logo":{"@type":"ImageObject","url":"https://mrcq.github.io/img/logo.svg"}},"description":"作者：muzing 原文链接：https:&#x2F;&#x2F;muzing.top&#x2F;posts&#x2F;a29e4743&#x2F;  良好的 Python 代码应有良好的格式规范（不止于遵守 PEP 8 ），使用一个更强大更专业的代码格式化工具，来替代编辑器自带的「格式化代码」功能是有一定必要的，这还可以使团队成员即使在不同编辑器下工作也可以得到完全相同的风格。相比于目前中文社区中较为流行的 autopep8，其实还有一个更好"}</script><link rel="canonical" href="https://mrcq.github.io/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto Serif Simplified Chinese:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?ed68212360e83c07d191372605274f6e";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><meta name="msvalidate.01" content="D5E963705D472839D42E0AC1C65D96AB"><script src="https://www.googletagmanager.com/gtag/js?id=G-X1YWL675NS" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-X1YWL675NS');</script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Kurisu&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">时间轴</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>Python代码格式化工具Black（转载）</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2022-11-10T08:36:32.000Z" title="2022-11-10T08:36:32.000Z">2022-11-10</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time dateTime="2022-11-10T08:52:45.687Z" title="2022-11-10T08:52:45.687Z">2022-11-10</time></span><span class="level-item"><a class="link-muted" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a><span> / </span><a class="link-muted" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a><span> / </span><a class="link-muted" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Python/">Python</a></span><span class="level-item">1 小时读完 (大约11426个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><div class="content"><blockquote>
<p>作者：muzing</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://muzing.top/posts/a29e4743/">https://muzing.top/posts/a29e4743/</a></p>
</blockquote>
<p>良好的 Python 代码应有良好的格式规范（不止于遵守 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> ），使用一个更强大更专业的<strong>代码格式化工具</strong>，来替代编辑器自带的「格式化代码」功能是有一定必要的，这还可以使团队成员即使在不同编辑器下工作也可以得到完全相同的风格。相比于目前中文社区中较为流行的 <a target="_blank" rel="noopener" href="https://github.com/hhatto/autopep8">autopep8</a>，其实还有一个更好的选择 —— <strong>Black</strong> 。<span id="more"></span></p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210923225124.jpg"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923225124.jpg" alt="Life is short, you need Python."></a></p>
<p>Life is short, you need Python.</p>
<p>本文采用了较全面介绍的写法，且对相当一部分的官方文档做了摘录翻译，篇幅较长。如果只是想简单快速上手使用工具，直接阅读前面关于安装、使用的几个小节即可（这些小节前面有这样的紫色的标记提醒），跳过其他部分不会有影响。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/python_black_logo.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/python_black_logo.png" alt="Black 的 Logo"></a></p>
<p>Black 的 Logo</p>
<blockquote>
<p>“Any color you like.”</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/psf/black">GItHub</a> | <a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/">官方文档</a> | <a target="_blank" rel="noopener" href="https://pypi.org/project/black/">PyPI</a> | <a target="_blank" rel="noopener" href="https://black.vercel.app/">在线试用</a></p>
<p>Black 自称“零妥协代码格式化工具（The uncompromising code formatter）”。</p>
<p>截止到 2022 年 5 月，Black 已经在 GitHub 斩获 27.4k 个 Stars，由 Google 开发维护的 <a target="_blank" rel="noopener" href="https://github.com/google/yapf]">YAPF</a> 为 12.5k ，而 <a target="_blank" rel="noopener" href="https://github.com/hhatto/autopep8">autopep8</a> 则只有 4.1k 。可以说 Black 是目前最广受好评的 Python 代码格式化工具。</p>
<p>“Talk is cheap. Show me the code.” 废话不多说，直接看疗效：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式化前</span></span><br><span class="line"><span class="keyword">from</span> seven_dwwarfs <span class="keyword">import</span> Grumpy, Happy, Sleepy, Bashful, Sneezy, Dopey, Doc</span><br><span class="line">x = &#123;  <span class="string">&#x27;a&#x27;</span>:<span class="number">37</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">42</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;c&#x27;</span>:<span class="number">927</span>&#125;</span><br><span class="line"></span><br><span class="line">x = <span class="number">123456789.123456789E123456789</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> very_long_variable_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> \</span><br><span class="line"> very_long_variable_name.field &gt; <span class="number">0</span> <span class="keyword">or</span> \</span><br><span class="line"> very_long_variable_name.is_debug:</span><br><span class="line"> z = <span class="string">&#x27;hello &#x27;</span>+<span class="string">&#x27;world&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"> world = <span class="string">&#x27;world&#x27;</span></span><br><span class="line"> a = <span class="string">&#x27;hello &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(world)</span><br><span class="line"> f = <span class="string">rf&#x27;hello <span class="subst">&#123;world&#125;</span>&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (this</span><br><span class="line"><span class="keyword">and</span> that): y = <span class="string">&#x27;hello &#x27;</span><span class="string">&#x27;world&#x27;</span><span class="comment">#<span class="doctag">FIXME:</span> https://github.com/psf/black/issues/26</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>  (     <span class="title class_ inherited__">object</span>  ):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">f</span>    (self   ):</span><br><span class="line">    <span class="keyword">return</span>       <span class="number">37</span>*-<span class="number">2</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">self, x,y=<span class="number">42</span></span>):</span><br><span class="line">      <span class="keyword">return</span> y</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>  (   a: <span class="type">List</span>[ <span class="built_in">int</span> ]) :</span><br><span class="line">  <span class="keyword">return</span>      <span class="number">37</span>-a[<span class="number">42</span>-u :  y**<span class="number">3</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">very_important_function</span>(<span class="params">template: <span class="built_in">str</span>,*variables,file: os.PathLike,debug:<span class="built_in">bool</span>=<span class="literal">False</span>,</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Applies `variables` to the `template` and writes to `file`.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">     ...</span><br><span class="line"><span class="comment"># fmt: off</span></span><br><span class="line">custom_formatting = [</span><br><span class="line">    <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,</span><br><span class="line">    <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,</span><br><span class="line">    <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># fmt: on</span></span><br><span class="line">regular_formatting = [</span><br><span class="line">    <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,</span><br><span class="line">    <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,</span><br><span class="line">    <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">PYTHON</span><br><span class="line"><span class="comment"># 使用 Black-v22.3.0 格式化后</span></span><br><span class="line"><span class="keyword">from</span> seven_dwwarfs <span class="keyword">import</span> Grumpy, Happy, Sleepy, Bashful, Sneezy, Dopey, Doc</span><br><span class="line"></span><br><span class="line">x = &#123;<span class="string">&quot;a&quot;</span>: <span class="number">37</span>, <span class="string">&quot;b&quot;</span>: <span class="number">42</span>, <span class="string">&quot;c&quot;</span>: <span class="number">927</span>&#125;</span><br><span class="line"></span><br><span class="line">x = <span class="number">123456789.123456789e123456789</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">    very_long_variable_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">and</span> very_long_variable_name.field &gt; <span class="number">0</span></span><br><span class="line">    <span class="keyword">or</span> very_long_variable_name.is_debug</span><br><span class="line">):</span><br><span class="line">    z = <span class="string">&quot;hello &quot;</span> + <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    world = <span class="string">&quot;world&quot;</span></span><br><span class="line">    a = <span class="string">&quot;hello &#123;&#125;&quot;</span>.<span class="built_in">format</span>(world)</span><br><span class="line">    f = <span class="string">rf&quot;hello <span class="subst">&#123;world&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> this <span class="keyword">and</span> that:</span><br><span class="line">    y = <span class="string">&quot;hello &quot;</span> <span class="string">&quot;world&quot;</span>  <span class="comment"># <span class="doctag">FIXME:</span> https://github.com/psf/black/issues/26</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">37</span> * -<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">self, x, y=<span class="number">42</span></span>):</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">a: <span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">37</span> - a[<span class="number">42</span> - u : y**<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">very_important_function</span>(<span class="params"></span></span><br><span class="line"><span class="params">    template: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    *variables,</span></span><br><span class="line"><span class="params">    file: os.PathLike,</span></span><br><span class="line"><span class="params">    debug: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Applies `variables` to the `template` and writes to `file`.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># fmt: off</span></span><br><span class="line">custom_formatting = [</span><br><span class="line">    <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,</span><br><span class="line">    <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,</span><br><span class="line">    <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># fmt: on</span></span><br><span class="line">regular_formatting = [</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="number">2</span>,</span><br><span class="line">    <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">5</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    <span class="number">8</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>经过 Black 重新格式化后，代码立刻就清爽舒适了很多。事实上，Black 有一套经过反复讨论、仔细研究得出的非常详尽的 Python 代码格式化风格，在本文的后面也会展开来讲（见 <a target="_blank" rel="noopener" href="https://muzing.top/posts/a29e4743/#the-black-code-style">The Black Code Style</a> 一节）。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>本节为快速上手必看</p>
<p>可以通过 pip 直接从 PyPI 下载安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install black</span><br></pre></td></tr></table></figure>

<p>注意需要 Python 3.6.2 以上的版本。</p>
<p>如果想在 <a target="_blank" rel="noopener" href="https://jupyter.org/">Jupyter Notebooks</a> 中使用，则可以通过如下代码安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install black[jupyter]</span><br></pre></td></tr></table></figure>

<p>如果急于试用最新版本，可以通过下面的命令从 GitHub 安装（不推荐）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install git+git://github.com/psf/black</span><br></pre></td></tr></table></figure>

<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><p>本节为快速上手必看</p>
<h3 id="作为脚本运行"><a href="#作为脚本运行" class="headerlink" title="作为脚本运行"></a>作为脚本运行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">black &#123;source_file_or_directory&#125;</span><br></pre></td></tr></table></figure>

<h3 id="作为-Python-包运行"><a href="#作为-Python-包运行" class="headerlink" title="作为 Python 包运行"></a>作为 Python 包运行</h3><p>如果将 Black 作为脚本运行不起作用，您可以尝试将其作为包运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m black &#123;source_file_or_directory&#125;</span><br></pre></td></tr></table></figure>

<h3 id="跳过字符串格式化"><a href="#跳过字符串格式化" class="headerlink" title="跳过字符串格式化"></a>跳过字符串格式化</h3><p>Black 会默认将字符串格式化为使用双引号包裹，但有些项目已经使用了单引号的规范且不应修改为双引号，就需要加上一个 <code>-S</code> / <code>--skip-string-normalization</code> 的选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">black -S &#123;source_file_or_directory&#125;</span><br></pre></td></tr></table></figure>

<h3 id="其他更多选项"><a href="#其他更多选项" class="headerlink" title="其他更多选项"></a>其他更多选项</h3><p>见 <a target="_blank" rel="noopener" href="https://muzing.top/posts/a29e4743/#%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%80%89%E9%A1%B9">详细使用 - 命令行选项</a> 一节</p>
<h2 id="集成到-IDE-编辑器中"><a href="#集成到-IDE-编辑器中" class="headerlink" title="集成到 IDE / 编辑器中"></a>集成到 IDE / 编辑器中</h2><p>本节为快速上手必看</p>
<p>相比于每次都专门打开一个终端，手动使用命令行调用 Black 格式化代码，我们更希望能把 Black 集成到我们常用的 IDE / 编辑器中，不需要离开写代码的界面即可完成格式化操作。</p>
<h3 id="在-PyCahrm-中使用"><a href="#在-PyCahrm-中使用" class="headerlink" title="在 PyCahrm 中使用"></a>在 PyCahrm 中使用</h3><p><a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/integrations/editors.html#pycharm-intellij-idea">Black 官方文档</a>中给出了在 PyCharm（或 IntelliJ IDEA）中配置使用 Black 的方法：</p>
<h4 id="确认-Black-安装位置"><a href="#确认-Black-安装位置" class="headerlink" title="确认 Black 安装位置"></a>确认 Black 安装位置</h4><p>在 macOS / Linux / BSD 上：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">which</span> black</span></span><br><span class="line">/usr/local/bin/black  # 可能的位置</span><br></pre></td></tr></table></figure>

<p>在 Windows 上：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">where</span> black</span><br><span class="line">%LocalAppData%\Programs\Python\Python36<span class="literal">-32</span>\Scripts\black.exe  <span class="comment"># 可能的位置</span></span><br></pre></td></tr></table></figure>

<p>如果是使用 Pycahrm 建立的虚拟环境，则直接使用 <code>$PyInterpreterDirectory$/black</code> 作为程序路径。</p>
<h4 id="在-PyCharm-中添加外部工具"><a href="#在-PyCharm-中添加外部工具" class="headerlink" title="在 PyCharm 中添加外部工具"></a>在 PyCharm 中添加外部工具</h4><p>打开 文件 -&gt; 设置 -&gt; 工具 -&gt; 外部工具</p>
<p>File -&gt; Settings -&gt; Tools -&gt; External Tools</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210925181843.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925181843.png"></a></p>
<p>打开设置-工具-外部工具</p>
<p>创建工具</p>
<ul>
<li>名称：Black</li>
<li>描述：毫不妥协的 Python 代码格式化工具</li>
<li>程序：「上一小节得到的安装位置」</li>
<li>参数：<code>$FilePath$</code></li>
<li>工作目录：<code>$ProjectFileDir$</code></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210925224338.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925224338.png"></a></p>
<p>编辑创建工具</p>
<p>如果需要<a target="_blank" rel="noopener" href="https://muzing.top/posts/a29e4743/#%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%80%89%E9%A1%B9">自定义其他选项</a>，写在 <code>$FilePath$</code> 前即可，比如代表「取消格式化字符串为双引号包裹”」的选项 <code>-S</code>：</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210926212642.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210926212642.png"></a></p>
<p>加上其他选项参数</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>在已经打开的代码编辑界面（或项目文件树的某个目录上）鼠标右键，找到 External Tools -&gt; Black，点击即可。</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210925224800.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925224800.png"></a></p>
<p>在右键菜单中使用 Black</p>
<h4 id="设置快捷键"><a href="#设置快捷键" class="headerlink" title="设置快捷键"></a>设置快捷键</h4><p>还可以在 设置 -&gt; 键盘映射 -&gt; 外部工具 -&gt; Black 上右键，打开编辑快捷键的菜单，添加键盘快捷键：</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210925225052.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210925225052.png"></a></p>
<p>设置快捷键</p>
<p>如果已经习惯了 PyCharm 默认的<code>Ctrl + Alt + L</code> 快捷键格式化代码，那么可以这样设置：</p>
<ol>
<li>在 主菜单 -&gt; 代码 -&gt; 重新格式化代码 中删去快捷键</li>
<li>给 外部工具 -&gt; External Tools -&gt; Black 设置键盘快捷键<code>Ctrl + Alt + L</code></li>
</ol>
<h4 id="保存文件时自动格式化（可选）"><a href="#保存文件时自动格式化（可选）" class="headerlink" title="保存文件时自动格式化（可选）"></a>保存文件时自动格式化（可选）</h4><ol>
<li>确保已经安装了 <a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/7177-file-watchers">File Watchers</a> 插件</li>
<li>进入 设置 -&gt; 工具 -&gt; File Watchers，点击 + 以添加一个新的 watcher：<ul>
<li>Name: Black</li>
<li>File type: Python</li>
<li>Scope: Project Files</li>
<li>Program: 上一小节得到的安装位置</li>
<li>Arguments: <code>$FilePath$</code></li>
<li>Output paths to refresh: <code>$FilePath$</code></li>
<li>Working directory: <code>$ProjectFileDir$</code></li>
</ul>
</li>
<li>在高级选项中：<ul>
<li>取消勾选 “Auto-save edited files to trigger the watcher”</li>
<li>取消勾选 “Trigger the watcher on external changes”</li>
</ul>
</li>
</ol>
<h3 id="在-VS-Code-中使用"><a href="#在-VS-Code-中使用" class="headerlink" title="在 VS Code 中使用"></a>在 VS Code 中使用</h3><p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/python/editing#_formatting">VS Code 官方文档介绍</a></p>
<h4 id="安装-Python-插件"><a href="#安装-Python-插件" class="headerlink" title="安装 Python 插件"></a>安装 Python 插件</h4><p>首先确保已经在 VS Code 中安装了 Python 插件。如果没有安装，则在 VS Code 中按下 <code>Ctrl + P</code> ，并输入如下命令：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ext install ms-python.python</span><br></pre></td></tr></table></figure>

<p>或者直接在扩展商店中搜索 Python 并安装。</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210923205215.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205215.png"></a></p>
<p>在 VS Code 中安装 Python 插件</p>
<h4 id="配置-Python-扩展"><a href="#配置-Python-扩展" class="headerlink" title="配置 Python 扩展"></a>配置 Python 扩展</h4><p>按下 <code>Ctrl + ,</code> ，打开 VS Code 设置</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210923205522.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205522.png"></a></p>
<p>打开 VS Code 设置</p>
<p>在「设置」中搜索 python formatting provider ，然后把默认的 autopep8 改为 black 即可。</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210923210132.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210132.png"></a></p>
<p>更改 Python Formatting Provider</p>
<h4 id="保存文件时自动格式化代码（可选）"><a href="#保存文件时自动格式化代码（可选）" class="headerlink" title="保存文件时自动格式化代码（可选）"></a>保存文件时自动格式化代码（可选）</h4><p>在「设置」界面搜索 format on save ，可以勾选打开保存时格式化文件的功能。</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210923205845.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923205845.png"></a></p>
<p>保存时自动格式化</p>
<h4 id="取消格式化为双引号包裹字符串（可选）"><a href="#取消格式化为双引号包裹字符串（可选）" class="headerlink" title="取消格式化为双引号包裹字符串（可选）"></a>取消格式化为双引号包裹字符串（可选）</h4><p>在「设置」界面的右上角打开 <code>settings.json</code> 配置文件</p>
<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210923210441.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210441.png"></a></p>
<p>打开 json 配置文件</p>
<p>在配置文件中添加一行</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;python.formatting.blackArgs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;--skip-string-normalization&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://oss.muzing.top/image/20210923210902.png"><img src="/2022/11/10/Python/Python%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7Black/20210923210902.png"></a></p>
<p>添加一行 Black 运行选项</p>
<p>注意每个人的 <code>settings.json</code> 配置文件都有所不同，行号不太一样，在文件末尾新建一行添加即可。</p>
<h3 id="使用-Black-Formatter-插件"><a href="#使用-Black-Formatter-插件" class="headerlink" title="使用 Black Formatter 插件"></a>使用 Black Formatter 插件</h3><p>微软官方出品的 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">Python 扩展</a>体积日渐增长，故微软也在逐渐将其部分功能拆分为单独的扩展。目前 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=ms-python.black-formatter">Black Formatter 扩展</a>已经以预发布状态上线 VS Code 插件商店。待该插件转为正式版时，本文会同步更新。</p>
<h3 id="在-Vim-中使用"><a href="#在-Vim-中使用" class="headerlink" title="在 Vim 中使用"></a>在 Vim 中使用</h3><p>同样可以在 <a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/integrations/editors.html">Black 官方文档</a>中找到在 Vim 中使用 Black 官方插件的方法：<a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/integrations/editors.html#vim">https://black.readthedocs.io/en/stable/integrations/editors.html#vim</a></p>
<h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><p>Black 还可以集成到许多其他编辑器中。此外，官方文档还给出了集成至 <a target="_blank" rel="noopener" href="https://docs.github.com/cn/actions">GitHub Actions</a> 中、集成至利用 <a target="_blank" rel="noopener" href="https://pre-commit.com/">pre-commit</a> 工具实现的版本控制集成工作流中的方法，这样每次更新项目都会自动使用 Black 重新格式化代码了。</p>
<p>详见文档：<a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/integrations/index.html">https://black.readthedocs.io/en/stable/integrations/index.html</a></p>
<h2 id="详细使用"><a href="#详细使用" class="headerlink" title="详细使用"></a>详细使用</h2><blockquote>
<p>摘录翻译自官方文档 <a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#usage">Usage and Configuration - The basics</a></p>
</blockquote>
<p>Black 是一个工作良好的 Unix 风格命令行工具：</p>
<ul>
<li>当没有原文件传入时什么都不会做</li>
<li>如果使用 <code>-</code> 作为文件名，则将会从标准输入读取并写入到标准输出</li>
<li>只向用户输出标准错误信息</li>
<li>当没有内部错误发生时，退出代码为 0 （除非使用了 <code>--check</code> 选项）</li>
</ul>
<h3 id="命令行选项"><a href="#命令行选项" class="headerlink" title="命令行选项"></a>命令行选项</h3><p>Black 倾向于“独裁”，故意限制并很少添加选项，然而这却反而成了它备受赞赏的一点——既然要统一格式，就不应该有太多个性化选项。</p>
<p>下面列出了 Black 的 Help 输出，并尽我所能做了翻译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black --<span class="built_in">help</span></span></span><br><span class="line">使用： black [OPTIONS] SRC ...</span><br><span class="line"></span><br><span class="line">  零妥协的代码格式化工具。</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  -c, --code TEXT                 将传入的代码作为字符串格式化。</span><br><span class="line">  </span><br><span class="line">  -l, --line-length INTEGER       每行允许的字符数。</span><br><span class="line">                                  [默认值： 88]</span><br><span class="line"></span><br><span class="line">  -t, --target-version            [py27|py33|py34|py35|py36|py37|py38|py39]</span><br><span class="line">                                  Black 的输出应该支持的 Python 版本</span><br><span class="line">                                  [默认值：每个文件自动检测]</span><br><span class="line"></span><br><span class="line">  --pyi                           不考虑文件扩展名，将所有输入文件格式化为 typing stubs</span><br><span class="line">                                  （当使用来自标准输入的管道时很有用）。</span><br><span class="line"></span><br><span class="line">  --ipynb                         不考虑文件扩展名，将所有输入文件格式化为 Jupyter</span><br><span class="line">                                  Notebooks 风格（当使用来自标准输入的管道时很有用）。</span><br><span class="line">  </span><br><span class="line">  -S, --skip-string-normalization 不要标准化字符串引号或前缀。</span><br><span class="line">  </span><br><span class="line">  -C, --skip-magic-trailing-comma 不要将尾随逗号作为分割行的理由。</span><br><span class="line">  </span><br><span class="line">  --check                         不要写回文件，只返回状态。</span><br><span class="line">                                  返回代码 0 意味着没有任何改变。</span><br><span class="line">                                  返回代码 1 意味着有些文件将被重新格式化。</span><br><span class="line">                                  返回代码 123 意味着存在 internal error 内部错误。</span><br><span class="line">  </span><br><span class="line">  --diff                          不要写回文件， 只是使用 stdout 标准输出显示</span><br><span class="line">                                  每个文件的 diff 差异。</span><br><span class="line">  </span><br><span class="line">  --color / --no-color            显示彩色的 diff。 只有当使用了`--diff` 选项才生效。</span><br><span class="line">  </span><br><span class="line">  --fast / --safe                 如果给定了 --fast，则跳过 temporary sanity</span><br><span class="line">                                  检查。 [默认值： --safe]</span><br><span class="line">  </span><br><span class="line">  --required-version TEXT         需要运行特定版本的 Black （用于在不同环境上得到同样的</span><br><span class="line">                                  结果，比如使用一个 pyproject.toml 文件）。</span><br><span class="line">  </span><br><span class="line">  --include TEXT                  匹配递归搜索中应包含的文件和目录的正则表达式。</span><br><span class="line">                                  空值意味着包含所有文件（无论文件名是什么）。</span><br><span class="line">                                  对所有平台上的目录使用正斜杠（在 Windows 上亦是如此）。 </span><br><span class="line">                                  首先匹配要排除的项，然后匹配包含项。</span><br><span class="line">                                  [默认值： (\.pyi?|\.ipynb)$]</span><br><span class="line">  </span><br><span class="line">  --exclude TEXT                  匹配递归搜索中应排除的文件和目录的正则表达式。</span><br><span class="line">                                  空值意味着不排除任何路径。 </span><br><span class="line">                                  对所有平台上的目录使用正斜杠（在 Windows 亦是如此）。</span><br><span class="line">                                  首先匹配要排除的项，然后匹配包含项。</span><br><span class="line">                                  [默认值： /(\.direnv|\.eggs|\.git|\.h</span><br><span class="line">                                  g|\.mypy_cache|\.nox|\.tox|\.venv|venv|\.svn</span><br><span class="line">                                  |_build|buck-out|build|dist)/]</span><br><span class="line">  </span><br><span class="line">  --extend-exclude TEXT           类似 --exclude，但在排除的文件和目录之上</span><br><span class="line">                                  添加了额外的文件和目录。（如果您只是想简单地添加到</span><br><span class="line">                                  默认值，这会很有用）</span><br><span class="line">  </span><br><span class="line">  --force-exclude TEXT            类似 --exclude，但是与此正则表达式匹配的文件和目录</span><br><span class="line">                                  将被排除，即使它们作为参数显式传递。</span><br><span class="line">  </span><br><span class="line">  --stdin-filename TEXT           通过 stdin 标准输入传递时的文件名。</span><br><span class="line">                                  有助于确保 Black 在某些依赖使用 stdin 的编辑器上</span><br><span class="line">                                  尊重 --force-exclude 选项。</span><br><span class="line">  </span><br><span class="line">  -q, --quiet                     不向 stderr 输出非报错信息。</span><br><span class="line">                                  错误信息仍然会被输出； </span><br><span class="line">                                  使用 2&gt;/dev/null 关闭这些信息。</span><br><span class="line">  </span><br><span class="line">  -v, --verbose                   还向 stderr 输出文件未更改或因为排除模式被忽略的信息。</span><br><span class="line">  </span><br><span class="line">  --version                       显示版本并退出。</span><br><span class="line">  </span><br><span class="line">  --config FILE                   从 FILE 路径读取配置。</span><br><span class="line">  </span><br><span class="line">  -h, --help                      显示本帮助信息并退出。</span><br></pre></td></tr></table></figure>

<h3 id="代码输入选择"><a href="#代码输入选择" class="headerlink" title="代码输入选择"></a>代码输入选择</h3><h4 id="从标准输入读取"><a href="#从标准输入读取" class="headerlink" title="从标准输入读取"></a>从标准输入读取</h4><p>Black 支持从 stdin 标准输入中读取并格式化代码，并将结果输出至 stdout 标准输出。只需把 <code>-</code> 作为传入路径即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;print ( &#x27;hello, world&#x27; )&quot;</span> | black -</span></span><br><span class="line">print(&quot;hello, world&quot;)</span><br><span class="line">reformatted -</span><br><span class="line">All done! ✨ 🍰 ✨</span><br><span class="line">1 file reformatted.</span><br></pre></td></tr></table></figure>

<p><strong>提示</strong>：如果您需要 Black 把 stdin 标准输入视作一个直接通过 CLI 传来的文件，请使用<code>--stdin-filename</code> 选项。这有助于确保 Black 在某些依赖使用 stdin 的编辑器上考虑 <code>--force-exclude</code> 选项。</p>
<h4 id="作为字符串"><a href="#作为字符串" class="headerlink" title="作为字符串"></a>作为字符串</h4><p>您也可以通过 <code>-c</code> / <code>--code</code> 选项来把代码作为字符串传递</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black --code <span class="string">&quot;print ( &#x27;hello, world&#x27; )&quot;</span></span></span><br><span class="line">print(&quot;hello, world&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="写回与报告"><a href="#写回与报告" class="headerlink" title="写回与报告"></a>写回与报告</h3><p>默认情况下，Black 会原地重新格式化给定的文件。有时候您只需要知道 Black 将会做什么，而无需真的重新写入 Python 文件中。</p>
<p>有两种方式实现这个效果，分别通过各自的选项独立开启，也可以同时启用。</p>
<h4 id="退出代码"><a href="#退出代码" class="headerlink" title="退出代码"></a>退出代码</h4><p>传递 <code>--check</code> 参数将使 Black 以如下代码退出：</p>
<ul>
<li>代码 0 ：没有任何文件将被改变</li>
<li>代码 1 ：有些文件将被重新格式化</li>
<li>代码 123：出现内部错误</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black test.py --check</span></span><br><span class="line">All done! ✨ 🍰 ✨</span><br><span class="line">1 file would be left unchanged.</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> $?</span></span><br><span class="line">0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black test.py --check</span></span><br><span class="line">would reformat test.py</span><br><span class="line">Oh no! 💥 💔 💥</span><br><span class="line">1 file would be reformatted.</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> $?</span></span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black test.py --check</span></span><br><span class="line">error: cannot format test.py: INTERNAL ERROR: Black produced code that is not equivalent to the source.  Please report a bug on https://github.com/psf/black/issues.  This diff might be helpful: /tmp/blk_kjdr1oog.log</span><br><span class="line">Oh no! 💥 💔 💥</span><br><span class="line">1 file would fail to reformat.</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> $?</span></span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<h4 id="差异比较"><a href="#差异比较" class="headerlink" title="差异比较"></a>差异比较</h4><p>传递 <code>--diff</code> 参数以使 Black 打印出差异，表明其将要做出的更改。这将会输出到 stdout 标准输出，因此很容易捕获。</p>
<p>使用 <code>--color</code> 来开启彩色差异比较。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black test.py --diff</span></span><br><span class="line">--- test.py     2021-03-08 22:23:40.848954 +0000</span><br><span class="line">+++ test.py     2021-03-08 22:23:47.126319 +0000</span><br><span class="line">@@ -1 +1 @@</span><br><span class="line">-print ( &#x27;hello, world&#x27; )</span><br><span class="line">+print(&quot;hello, world&quot;)</span><br><span class="line">would reformat test.py</span><br><span class="line">All done! ✨ 🍰 ✨</span><br><span class="line">1 file would be reformatted.</span><br></pre></td></tr></table></figure>

<h3 id="详细输出"><a href="#详细输出" class="headerlink" title="详细输出"></a>详细输出</h3><p>一般来说，Black 尽可能生成适量的输出，在使用性和简洁性之间取得平衡。默认情况下，Black 会输出已修改的文件和错误消息，再加上一个简短的摘要。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black src/</span></span><br><span class="line">error: cannot format src/black_primer/cli.py: Cannot parse: 5:6: mport asyncio</span><br><span class="line">reformatted src/black_primer/lib.py</span><br><span class="line">reformatted src/blackd/__init__.py</span><br><span class="line">reformatted src/black/__init__.py</span><br><span class="line">Oh no! 💥 💔 💥</span><br><span class="line">3 files reformatted, 2 files left unchanged, 1 file failed to reformat.</span><br></pre></td></tr></table></figure>

<p>传递 <code>-v</code> / <code>--verbose</code> 选项会让 Black 也输出有关未更改的文件或由于排除模式而被忽略的文件的信息。如果 Black 使用了配置文件，则会输出一条蓝色的消息，详细说明它正在使用哪个配置文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black src/ -v</span></span><br><span class="line">Using configuration from /tmp/pyproject.toml.</span><br><span class="line">src/blib2to3 ignored: matches the --extend-exclude regular expression</span><br><span class="line">src/_black_version.py wasn&#x27;t modified on disk since last run.</span><br><span class="line">src/black/__main__.py wasn&#x27;t modified on disk since last run.</span><br><span class="line">error: cannot format src/black_primer/cli.py: Cannot parse: 5:6: mport asyncio</span><br><span class="line">reformatted src/black_primer/lib.py</span><br><span class="line">reformatted src/blackd/__init__.py</span><br><span class="line">reformatted src/black/__init__.py</span><br><span class="line">Oh no! 💥 💔 💥</span><br><span class="line">3 files reformatted, 2 files left unchanged, 1 file failed to reformat</span><br></pre></td></tr></table></figure>

<p>传递 <code>-q</code> / <code>--quiet</code> 选项会让 Black 停止输出所有的非严重信息。此时错误信息仍然会输出（这可以通过 <code>2&gt;dev&gt;null</code> 关闭）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black src/ -q</span></span><br><span class="line">error: cannot format src/black_primer/cli.py: Cannot parse: 5:6: mport asyncio</span><br></pre></td></tr></table></figure>

<h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p>您可以使用 <code>--version</code> 标志来检查您已经安装的 Black 版本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black --version</span></span><br><span class="line">black, version 21.9b0</span><br></pre></td></tr></table></figure>

<p>还提供了要求运行特定版本的选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black --required-version 21.9b0 -c <span class="string">&quot;format = &#x27;this&#x27;&quot;</span></span></span><br><span class="line">format = &quot;this&quot;</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">black --required-version 31.5b2 -c <span class="string">&quot;still = &#x27;beta?!&#x27;&quot;</span></span></span><br><span class="line">Oh no! 💥 💔 💥 The required version does not match the running version!</span><br></pre></td></tr></table></figure>

<p>在安装了不一定相同的版本的多个环境中运行 Black 时，这个选项非常有用。 可以在配置文件中设置此选项，以获得跨环境的一致结果。</p>
<h2 id="通过文件配置"><a href="#通过文件配置" class="headerlink" title="通过文件配置"></a>通过文件配置</h2><blockquote>
<p>翻译自<a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#configuration-via-a-file">官方文档</a></p>
</blockquote>
<p>Black 能够从 <code>pyproject.toml</code> 文件中读取对于特定项目其命令行选项的默认值。 这对为您的项目指定自定义 <code>--include</code> 和 <code>--exclude/--force-exclude/--extend-exclude</code> 模式特别有用。</p>
<p><strong>提示</strong>：当您在问自己“我是否需要配置任何东西”时，回答是否定的。Black 的一切皆为合理的默认值。使用这些默认选项将会使您的代码符合许多其他 Black 格式的项目。</p>
<h3 id="pyproject-toml-文件"><a href="#pyproject-toml-文件" class="headerlink" title="pyproject.toml 文件"></a>pyproject.toml 文件</h3><p><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0518/">PEP 518</a> 定义了 <code>pyproject.toml</code> 为用于存储 Python 项目构建系统需求（build system requirements）的配置文件。在 <a target="_blank" rel="noopener" href="https://python-poetry.org/">Poetry</a> 或 <a target="_blank" rel="noopener" href="https://flit.readthedocs.io/en/latest/">Flit</a> 的帮助下，它能够取代 <code>setup.py</code> 和 <code>setup.cfg</code> 文件。</p>
<h3 id="查找路径"><a href="#查找路径" class="headerlink" title="查找路径"></a>查找路径</h3><p>默认情况下，Black 将从命令行上传递的所有文件和目录的公共基目录开式查找 <code>pyproject.toml</code> 。如果不存在，则查找父目录。当它找到文件，或者一个 <code>.git</code> 目录，或一个 <code>.hg</code> 目录，或文件系统的根目录时，则停止查找，以先找到的为准。</p>
<p>如果您正在从标准输入进行格式化，Black 将从当前工作目录开始查找配置。</p>
<p>您可以使用一个存储在您的家目录的特定位置的“全局”配置。这是一个备用配置，即当且仅当 Black 未找到上述的任何配置时才会使用。根据您的操作系统，此文件的存储位置应为：</p>
<ul>
<li>Windows： <code>~\.black</code></li>
<li>类Unix系统 （Linux, MacOS等）： <code>$XDG_CONFIG_HOME/black</code> （如果没有设置 <code>XDG_CONFIG_HOME</code> 环境变量，则为 <code>~/.config/black</code>）</li>
</ul>
<p>注意，这些是 TOML 文件本身的路径（意味着它们不应该被命名为 <code>pyproject.toml</code> ），而不是您存储配置的目录。这里 <code>~</code> 代表您的家目录的绝对路径。在 Windows 上，这会是类似于 <code>C:\\Users\UserName</code> 的东西。</p>
<p>您还可以使用 <code>--config</code> 选项来显示指定您想使用的特定文件。在这种情况下，Black 不会寻找任何其他文件。</p>
<p>如果您在运行时使用了 <code>--verbose</code> 选项，如果找到并使用了配置文件，您将会看到一条蓝色的消息。</p>
<p>请注意，<code>blackd</code> 将不会使用 <code>pyproject.toml</code> 配置。</p>
<h3 id="配置格式"><a href="#配置格式" class="headerlink" title="配置格式"></a>配置格式</h3><p>如文件扩展名所示，<code>pyproject.toml</code> 是一个 <a target="_blank" rel="noopener" href="https://github.com/toml-lang/toml">TOML</a> 文件。它包含不同工具对应的不同的部分。Black 使用 <code>[tool.black]</code> 部分。选项的键与命令行选项中的长名称相同。</p>
<p>请注意，对于正则表达式，您必须在 TOML 中使用单引号字符串。它相当于 Python 中的 r-strings 。Black 将多行字符串视为冗长的正则表达式。使用 <code>[]</code> 标明重要的空格字符。</p>
<p>一个 <code>pyproject.toml</code> 的例子：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.black]</span></span><br><span class="line"><span class="attr">line-length</span> = <span class="number">88</span></span><br><span class="line"><span class="attr">target-version</span> = [<span class="string">&#x27;py37&#x27;</span>]</span><br><span class="line"><span class="attr">include</span> = <span class="string">&#x27;\.pyi?$&#x27;</span></span><br><span class="line"><span class="attr">extend-exclude</span> = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"># A regex preceded with ^/ will apply only to files and directories</span></span><br><span class="line"><span class="string"># in the root of the project.</span></span><br><span class="line"><span class="string">^/foo.py  # exclude a file named foo.py in the root of the project (in addition to the defaults)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置项使用层级关系"><a href="#配置项使用层级关系" class="headerlink" title="配置项使用层级关系"></a>配置项使用层级关系</h3><p>命令行选项具有默认值，可以在 <code>--help</code> 中查看（见本文<a target="_blank" rel="noopener" href="https://muzing.top/posts/a29e4743/#%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%80%89%E9%A1%B9">上一小节</a>）。<code>pyproject.toml</code> 会覆盖默认配置。而用户通过命令行输入的选项具有最高优先级，将覆盖前两者。</p>
<p>Black 在整个运行过程中只会使用一个 <code>pyproject.toml</code> 文件。 它不会查找多个文件，也不会从文件层次结构的不同级别组合配置。</p>
<h2 id="The-Black-Code-Style"><a href="#The-Black-Code-Style" class="headerlink" title="The Black Code Style"></a>The Black Code Style</h2><p>我将 <a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html">The <em>Black</em> code style - Current style</a> 英文文档全部做了翻译，感兴趣的小伙伴可以仔细阅读一下。</p>
<h3 id="代码风格"><a href="#代码风格" class="headerlink" title="代码风格"></a>代码风格</h3><p>Black 原地重新格式化整个文件（即直接将重新格式化的结果写回并覆盖原文件）。代码风格配置可选项故意限制得很少，且很少添加新选项。除了神奇的尾随逗号（trailing comma）和保留换行符，它不会考虑以前的代码格式。以 <code># fmt: off</code> 开头并以 <code># fmt: on</code> 结尾的代码块，或以 <code># fmt: skip</code> 结尾的行不会被重新格式化。<code># fmt: on/off</code> 必须在相同级别的缩进位置。出于礼貌，它也对 <a target="_blank" rel="noopener" href="https://github.com/google/yapf">YAPF</a> 的块注释具有相同的效果。</p>
<h4 id="换行方式"><a href="#换行方式" class="headerlink" title="换行方式"></a>换行方式</h4><p>Black 会忽略先前的格式，并对代码应用统一的空格和换行方式。空格的风格可以总结为：取悦 <code>pycodestyle</code> 。Black 使用的代码风格可以视为是 PEP 8 的严格子集。</p>
<p>对于换行，Black 试着让每一行都只有一个完整的表达式或简单语句。如果这符合指定的行长度就更好了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in:</span></span><br><span class="line"></span><br><span class="line">j = [<span class="number">1</span>,</span><br><span class="line">     <span class="number">2</span>,</span><br><span class="line">     <span class="number">3</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># out:</span></span><br><span class="line"></span><br><span class="line">j = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<p>否则，Black 将查看第一个外部括号匹配的内容，并将其放在单独的缩进行中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in:</span></span><br><span class="line"></span><br><span class="line">ImportantClass.important_method(exc, limit, lookup_lines, capture_locals, extra_argument)</span><br><span class="line"></span><br><span class="line"><span class="comment"># out:</span></span><br><span class="line"></span><br><span class="line">ImportantClass.important_method(</span><br><span class="line">    exc, limit, lookup_lines, capture_locals, extra_argument</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如果这仍然不符合要求，它将使用相同的规则进一步分解内部表达式，每次在匹配的括号处缩进。 如果匹配括号对的内容是逗号分隔的（如参数列表，字典文字等），那么 Black 将首先尝试将它们与对应匹配的括号保持在同一行。 如果仍然不行，它会将这些内容放在单独的行中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">very_important_function</span>(<span class="params">template: <span class="built_in">str</span>, *variables, file: os.PathLike, engine: <span class="built_in">str</span>, header: <span class="built_in">bool</span> = <span class="literal">True</span>, debug: <span class="built_in">bool</span> = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Applies `variables` to the `template` and writes to `file`.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># out:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">very_important_function</span>(<span class="params"></span></span><br><span class="line"><span class="params">    template: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    *variables,</span></span><br><span class="line"><span class="params">    file: os.PathLike,</span></span><br><span class="line"><span class="params">    engine: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    header: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    debug: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Applies `variables` to the `template` and writes to `file`.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p>Black 更喜欢括号而不是反斜杠，如果找到反斜杠则会删除：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> some_short_rule1 \</span><br><span class="line">  <span class="keyword">and</span> some_short_rule2:</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># out:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> some_short_rule1 <span class="keyword">and</span> some_short_rule2:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># in:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> some_long_rule1 \</span><br><span class="line">  <span class="keyword">and</span> some_long_rule2:</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># out:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">    some_long_rule1</span><br><span class="line">    <span class="keyword">and</span> some_long_rule2</span><br><span class="line">):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>反斜杠和多行字符串是 Python 语法中最主要的破坏缩进的两项。永远不要使用反斜杠，它们用于强制换行（即在原本换行将引起语法错误的地方换行），这使得它们令人困惑且难以修改。所以 Black 极力避免反斜杠。</p>
<p>如果您在您的代码中使用了反斜杠，这表明您只要稍作重构就可以明显优化代码。希望上面的例子能有所启发。</p>
<p>右括号总是缩进，并且添加一个尾随逗号。这种格式产生更小的差异：当添加或删除一个元素时，总是只占一行。此外，使右括号在代码的两个不同部分，而不是相同的缩进级别（比如上面那个例子中的参数列表和文档字符串），使得分隔更清晰。</p>
<p>如果组合数据结构（元组、列表、集合、字典），或者一行 “from” 导入无法适应分配的长度，则 Black 总是把每一项拆分到单独的一行中。这最大限度地减小了差异，同时使得阅读代码的人能够找到引入特定条目的 commit 。这还使得 Black 和带有现成的 <code>black</code> 配置文件或手动配置的 <a target="_blank" rel="noopener" href="https://black.readthedocs.io/en/stable/guides/using_black_with_other_tools.html#isort">isort</a> 兼容。</p>
<h4 id="行长度"><a href="#行长度" class="headerlink" title="行长度"></a>行长度</h4><p>Black 默认行长度比较特殊，为每行 88 个字符，恰好比 80 多 10% 。这个行长度下的文件总长度要比坚持使用 80（最流行的），或者甚至 79 （标准库使用的）要短的多。总的来说，90 似乎是明智之选。</p>
<p>如果您按照自己的代码规范限制行长度，您可以通过 <code>--line-length</code> 传递一个较小的数字。 Black 会尽量尊重该选项。 但是，有时这会造成冲突。 在极少数情况下，自动格式化的代码行长度将超出您设置的限制。</p>
<p>您也可以增加行长度，但请记住，有视力障碍的人阅读超过 100 个字符的行会很困难。 这还会对典型屏幕分辨率下的并排差异审查造成不便。 太长的行也使得在文档或幻灯片中整齐地呈现代码变得更加困难。</p>
<p>如果您在使用 Flake8 ，您可以将 <code>max-line-length</code> 提高到88，然后几乎忘掉这些。但是更好的选择是使用 <a target="_blank" rel="noopener" href="https://github.com/PyCQA/flake8-bugbear">Bugbear</a> 的 B950 警告替代 E501，然后提高行最大长度到 88（或者您在 Black 上使用的 <code>--line-length</code>），这会更和 Black 的 <em>“尽可能尊重 <code>--line-length</code> ，但是达不到也不要强求”</em> 保持一致。您会这样做：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[flake8]</span></span><br><span class="line"><span class="attr">max-line-length</span> = <span class="number">88</span></span><br><span class="line">...</span><br><span class="line"><span class="attr">select</span> = C,E,F,W,B,B950</span><br><span class="line"><span class="attr">extend-ignore</span> = E203, E501</span><br></pre></td></tr></table></figure>

<p>可以在本文档中进一步了解 E203 被禁用的原因。如果您对 B950 背后的原因感到好奇，<a target="_blank" rel="noopener" href="https://github.com/PyCQA/flake8-bugbear#opinionated-warnings">Bugbear 的文档</a>对此进行了解释。“就像高速公路上的限速，超速几迈不会有什么麻烦。”</p>
<p><strong>一个最精简的、兼容 Black 的 Flake8 配置：</strong></p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[flake8]</span></span><br><span class="line"><span class="attr">max-line-length</span> = <span class="number">88</span></span><br><span class="line"><span class="attr">extend-ignore</span> = E203</span><br></pre></td></tr></table></figure>

<h4 id="空白行"><a href="#空白行" class="headerlink" title="空白行"></a>空白行</h4><p>Black 避免使用无用的空行。这是符合 PEP 8 精神的，即函数内的空行应该谨慎使用。</p>
<p>Black 允许在函数内有单空行，以及原编辑器中在模块级别中使用的单空行和双空行（除非它们在括号内的表达式中）。由于这些表达式总是被重新格式化以占用最小空间，所以这些空行会丢失。</p>
<p>Black 还会在函数定义之前和之后插入适当的空行。内部函数前后一行，模块级别的函数和类前后两行。Black 不会在函数 / 类定义和紧挨着给定函数 / 类之前的独立注释之间插入空行。</p>
<p>Black 将在类级别的文档字符串和第一个后续字段或方法之间强行控制为一个空行，这符合 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0257/#multi-line-docstrings">PEP 257</a> 。</p>
<p>Black 不会在函数文档字符串后插入空行，除非由于内部函数紧随其后，需要空行分隔。</p>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>Black 不格式化注释内容，但它会在同一行的代码和注释之间强制使用两个空格，并在注释文本开始之前添加一个空格。Black 会考虑某些需要特定间距规则的注释类型：文档注释（<code>#: comment</code>）、section comments with long runs of hashes、Spyder 的 cell 。有时可能因为格式更改而移动注释，这可能会破坏为其分配特殊含义的工具的执行效果。哈希运算后的不间断空格也被保留。更多讨论，请看<a target="_blank" rel="noopener" href="https://muzing.top/posts/a29e4743/#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%89%8D%E5%90%8E%E7%9A%84-ast">格式化前后的 AST</a> 一节。</p>
<h4 id="尾随逗号"><a href="#尾随逗号" class="headerlink" title="尾随逗号"></a>尾随逗号</h4><p>Black 将向由逗号分隔的表达式添加尾随逗号，每个元素占据单独的一行。这包括函数声明。</p>
<p>添加尾随逗号的一个例外情况是，函数声明包括 <code>*</code>， <code>*args</code>，或 <code>**kwargs</code>。在这种情况下，尾随逗号只能在 Python 3.6 上安全使用。Black 将会检测您的文件是否已经是只兼容 3.6+ 并在这种情况下使用尾随逗号。 Black 的判断方法是，它会在带有星号的函数声明中查找 f-strings和尾随逗号的现有用法。换言之，如果您想在这种情况下使用尾随逗号而 Black 没有意识到这是安全的，那么在那里手动添加，Black 会保留它。</p>
<p>已经存在的尾随逗号提示 Black 始终将当前括号对的内容分解为每行一个项目。在下一小节中的<a target="_blank" rel="noopener" href="https://muzing.top/posts/a29e4743/#%E7%A5%9E%E5%A5%87%E7%9A%84%E5%B0%BE%E9%9A%8F%E9%80%97%E5%8F%B7">神奇的尾随逗号</a>获取更多关于此的信息。</p>
<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><p>相比于单引号（ <code>&#39;</code> 和 <code>&#39;&#39;&#39;</code>）， Black 更倾向于双引号（<code>&quot;</code> 和 <code>&quot;&quot;&quot;</code>）。只要不会导致出现更多的反斜杠转义，Black 就会用双引号替换单引号。</p>
<p>Black 还标准化了字符串前缀，使它们始终小写。最重要的是，如果您的代码已经是只用于 Python 3.6+ ，或者使用了 <code>unicode_literals</code> 未来导入，Black 将会从字符串前缀中删除 <code>u</code> ，因为它在这些情况下毫无意义。</p>
<p>美观是标准化到一个单一形式的引用的主要原因。在各处都使用相同风格的引用可以减少读者注意力分散。这还将使 Black 的未来版本能够合并以同一行结尾的连续字符串文字（详细有关信息，请参阅 <a target="_blank" rel="noopener" href="https://github.com/psf/black/issues/26">#26</a>）</p>
<p>为何选用双引号？他们估计在英文文本中会有撇号。它们符合 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0257/#what-is-a-docstring">PEP 257</a> 中描述的文档字符串标准。无论使用何种字体和语法高亮，双引号（<code>&quot;&quot;</code>）中的空字符串都不可能与单引号混淆。最重要的是，字符串使用双引号，与 Python 经常与之交互的 C 语言一致。</p>
<p>在某些键盘布局（如美国英语）上，键入单引号比双引号（需要使用 Shift 键）更容易一些。 我的建议是继续使用更快的输入方式，让 Black 去处理转换。</p>
<p>如果您在一个存在预先已有字符串约定（例如很流行的<a target="_blank" rel="noopener" href="https://stackoverflow.com/a/56190">在数据上使用单引号，人类阅读的字符串上使用双引号</a>）的大型项目上使用 Black ，您可以在命令行上传递 <code>--skip-string-normalization</code> 参数。这旨在采纳意见，应该避免将其用在新项目上。</p>
<p>作为一个实验选项（可以通过 <code>--experimental-string-processing</code> 启用），Black 拆分长字符串（在适当的情况下使用括号），并合并短字符串。拆分时，不需要格式化的 f-字符串部分将转换为纯字符串。当用户创建的分割不超过行长度限制时，它们将会被保留。用于表示行继续的反斜杠将被转换为带括号的字符串。不必要的括号将被删除。由于该功能是实验性的，故强烈建议您提供反馈和问题报告！</p>
<p>Black 还会处理文档字符串。首先会针对引用和其中的文本更正文档字符串的缩进，但是文本中的相对缩进会被保留。每行多余的尾随空格和文档字符串末尾的不必要的新行都会被删除。所有前导制表符都转换为空格，但保留文本内的制表符。删除单行文档字符串的前导/尾随空格。</p>
<h4 id="数字文字量"><a href="#数字文字量" class="headerlink" title="数字文字量"></a>数字文字量</h4><p>Black 将大多数数字文字量（numeric literals）标准化为语法部分使用小写字母，数字本身使用大写字母：<code>0xAB</code> 替换 <code>0XAB</code> 、<code>1e10</code> 替换 <code>1E10</code>。</p>
<h4 id="二元运算符与换行"><a href="#二元运算符与换行" class="headerlink" title="二元运算符与换行"></a>二元运算符与换行</h4><p>在将代码块拆分为多行时， Black 将在二元运算符之前换行。这是为了符合 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0008/#should-a-line-break-before-or-after-a-binary-operator">PEP 8</a> 中最近的更改：强调这种方法提高了可读性。</p>
<h4 id="切片类型"><a href="#切片类型" class="headerlink" title="切片类型"></a>切片类型</h4><p><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0008/#whitespace-in-expressions-and-statements">PEP 8 推荐</a>将切片中的 <code>:</code> 视为具有最低优先级的二元运算符，并在两边留下相同数量的空格，除非一个参数被省略（例如<code>ham[1 + 1 :]</code>）。它建议对于“简单表达式”，<code>:</code> 运算符周围不要加空格（<code>ham[lower:upper]</code>）；对于“复杂表达式”则添加额外空格（<code>ham[lower : upper + offset]</code>）。Black 把变量名之外的东西都视为“复杂”（<code>ham[lower : upper + 1]</code>）。它还指出，对于扩展的切片操作，除非省略了一个参数（<code>ham[1 + 1 ::]</code>），两个 <code>:</code> 运算符必须拥有相同的间距。Black 始终强制执行这些规则。</p>
<p>这些行为可能会在 Flake8 等强制风格指导工具中引发 <code>E203 whitespace before &#39;:&#39;</code> 警告。由于 <code>E203</code> 不符合 PEP 8，您应该设置 Flake8 忽略这些警告。</p>
<h4 id="括号"><a href="#括号" class="headerlink" title="括号"></a>括号</h4><p>在 Python 语法中，有些括号是可有可无的。任何表达式都可以用一对括号包裹组成一个原子。下面是几个有趣的例子：</p>
<ul>
<li><code>if (...):</code></li>
<li><code>while (...):</code></li>
<li><code>assert (...), (...)</code></li>
<li><code>from X import (...)</code></li>
<li>赋值，比如：<ul>
<li><code>target = (...)</code></li>
<li><code>target: type = (...)</code></li>
<li><code>some, *un, packing = (...)</code></li>
<li><code>augmented += (...)</code></li>
</ul>
</li>
</ul>
<p>在这些情况下，当整个语句适合一行时，或者如果内部表达式没有任何分隔符、可以进一步拆分，则会删除括号。如果只有一个分隔符，并且表达式以括号开头或结尾，括号也可以直接省略，因为现有的括号对无论如何都会整齐地组织表达式。否则，将添加括号。</p>
<p>请注意，Black 不会添加或删除任何额外的嵌套括号，为了清晰或进一步组织代码，您可能会希望使用这些括号。例如，这些括号不会被删除：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">not</span> (this <span class="keyword">or</span> that)</span><br><span class="line">decision = (maybe.this() <span class="keyword">and</span> values &gt; <span class="number">0</span>) <span class="keyword">or</span> (maybe.that() <span class="keyword">and</span> values &lt; <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h4 id="调用链"><a href="#调用链" class="headerlink" title="调用链"></a>调用链</h4><p>许多流行的 API（比如 ORM）使用调用链。这种 API 风格以流畅的接口闻名。Black 通过将调用或索引操作后面的点视作优先级非常低的分隔符来格式化这些代码。啰嗦无益，直接看代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>(<span class="params">session</span>):</span><br><span class="line">    result = (</span><br><span class="line">        session.query(models.Customer.<span class="built_in">id</span>)</span><br><span class="line">        .<span class="built_in">filter</span>(</span><br><span class="line">            models.Customer.account_id == account_id,</span><br><span class="line">            models.Customer.email == email_address,</span><br><span class="line">        )</span><br><span class="line">        .order_by(models.Customer.<span class="built_in">id</span>.asc())</span><br><span class="line">        .<span class="built_in">all</span>()</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h4 id="存根文件"><a href="#存根文件" class="headerlink" title="存根文件"></a>存根文件</h4><p><a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0484">PEP 484</a> 描述了 Python 中类型提示的语法。类型的用例之一是，为不能直接包含它们的模块提供类型注释（它们可能是用 C 编写的，或者它们可能是第三方的，或者它们的实现可能过于动态，等等）。</p>
<p>为了解决这个问题，可以使用<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0484/#stub-files">以<code>.pyi</code>为文件扩展名的存根文件</a>来描述外部模块的类型信息。这些存根文件省略了它们描述的类和函数的实现，而是只包含文件的结构（列出全局变量、函数和类及其成员）。这些文件的推荐代码风格比 PEP 8 更简洁：</p>
<ul>
<li>倾向于让 <code>...</code> 与类/函数签名处于同一行；</li>
<li>避免在单个类中的连续模块级函数、名称或方法和字段之间出现垂直空白；</li>
<li>在顶级类定义之间使用一个空行，如果类非常小，则不使用。</li>
</ul>
<p>Black 执行上述规则。目前尚未有强制性的格式化 <code>.pyi</code> 文件的指南，但可能会出现在格式化程序的未来版本中：</p>
<ul>
<li>所有的函数体都应该是空的（包含 <code>...</code> 而不是函数体）；</li>
<li>不使用文档字符串；</li>
<li>相比 <code>pass</code> 更倾向于使用 <code>...</code> ；</li>
<li>对于带有默认值的参数，使用 <code>...</code> 而不是实际的默认值；</li>
<li>避免在类型注释中使用字符串文字，存根文件本身支持前向引用（如带有 <code>from __future__ import annotations</code> 的 Python 3.7 代码）；</li>
<li>使用变量注释而不是类型注释，即使是针对旧版本 Python 的存根；</li>
<li>对于默认为 <code>None</code> 的参数，显式使用 <code>Optional[]</code> ；</li>
<li>使用 <code>float</code> 替换 <code>Union[int, float]</code> 。</li>
</ul>
<h3 id="实用主义"><a href="#实用主义" class="headerlink" title="实用主义"></a>实用主义</h3><p>早期版本的 Black 在某些方面是绝对主义者，紧跟最初作者的步伐。这在当时很好，使实现更简单，而且当时本来也没有多少用户。没有收到很多边缘案例的报告。作为一个成熟的工具，Black 确实对它的规则做了一些例外处理。本节记录了这些例外，以及其发生的原因。</p>
<h4 id="神奇的尾随逗号"><a href="#神奇的尾随逗号" class="headerlink" title="神奇的尾随逗号"></a>神奇的尾随逗号</h4><p>Black 在进行格式化时，通常不考虑已有的格式。</p>
<p>然而在某些情况下，您在代码中写了一个简短的集合或函数调用，但您估计未来会添加新的项，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TRANSLATIONS = &#123;</span><br><span class="line">    <span class="string">&quot;en_us&quot;</span>: <span class="string">&quot;English (US)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pl_pl&quot;</span>: <span class="string">&quot;polski&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>早期版本的 Black 通常会简单粗暴直接将它们折成一行（这很合适！）。现在。您可以通过自己在集合中放一个尾随逗号来表明您不希望这样。当您这样做时，Black 会总是将集合的每一项放在单独的一行中。</p>
<p>停用该特性的方法也很简单，只要删去尾随逗号，Black 就会在合适的情况下把您的集合折叠到一行中。</p>
<p>如果有必要，您可以使用 <code>--skip-magic-trailing-comma</code> / <code>-C</code> 选项来使得 Black 恢复早期版本的处理方式。</p>
<h4 id="r”strings”-与-R”strings”"><a href="#r”strings”-与-R”strings”" class="headerlink" title="r”strings” 与 R”strings”"></a>r”strings” 与 R”strings”</h4><p>Black 将字符串引号和字符串前缀标准化并使其小写。 此规则的一个例外是 r-strings 。 事实证明，非常流行的 <a target="_blank" rel="noopener" href="https://github.com/MagicStack/MagicPython/">MagicPython</a> 语法高亮器（GitHub、VS Code 等默认使用的都是这个），区分 r-strings 和 R-strings。 前者是作为正则表达式突出显示的语法，而后者被视为没有特殊语义的真正原始字符串。</p>
<h4 id="格式化前后的-AST"><a href="#格式化前后的-AST" class="headerlink" title="格式化前后的 AST"></a>格式化前后的 AST</h4><blockquote>
<p>译者注：<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/ast.html">AST</a>，即 <strong>A</strong>bstract <strong>s</strong>yntax <strong>T</strong>rees，抽象语法树</p>
</blockquote>
<p>当使用了 <code>--safe</code> 选项运行时，Black 会检查前后的代码在语义上是否相同。此检查是通过将源 AST 与目标 AST 进行比较来完成的。在三种有限的情况下，AST 确实有所不同：</p>
<ol>
<li>Black 清除文档字符串的前导和尾随空格，在必要情况下重新缩进。这是格式化程序最流行的用户报告功能之一，用于修复文档字符串的空白问题。虽然结果在技术上是 AST 差异，但由于形成文档字符串的各种可能性，我们知道的所有实时使用文档字符串都会清理缩进和前导/尾随空格。</li>
<li>Black 管理某些语句的可选括号。在 <code>del</code> 声明情况下，包装括号的有无会改变结果的 AST，但在解释器中语义是等效的。</li>
<li>Black 可能会移动注释，包括类型注释。这是 Python 3.8 中 AST 的一部分。虽然 Black 为这些注释实现了许多特殊情况，但不能保证它们将保持在源代码中的位置。注意这不会改变源代码运行时的行为。</li>
</ol>
<p>从长远来看，代码等价性检查是 Black 的一个特性，其他格式化程序根本没有实现这个特性。对我们来说，确保代码在重新格式化之前的行为方式至关重要。我们将此视为一项特性，并且未来也不会懈怠。上面列举的例外来自于用户反馈或工具的实现细节。在每种情况下，我们都进行了审慎检查，以确保 AST 差异没有实际影响。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="在-README-中展示"><a href="#在-README-中展示" class="headerlink" title="在 README 中展示"></a>在 README 中展示</h3><p>如果你的项目使用了 Black 工具，可以在 <a target="_blank" rel="noopener" href="http://readme.md/">README.md</a> 中加入下面一行</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">![Code style: black</span>](<span class="link">https://img.shields.io/badge/code%20style-black-000000.svg</span>)](<span class="link">https://github.com/psf/black</span>)</span><br></pre></td></tr></table></figure>

<p>这样就可以显示一个 shields 图标了：<a target="_blank" rel="noopener" href="https://github.com/psf/black">![Code style: black](Python代码格式化工具Black/code style-black-000000.svg)</a></p>
<h3 id="吃瓜：单引号？双引号"><a href="#吃瓜：单引号？双引号" class="headerlink" title="吃瓜：单引号？双引号"></a>吃瓜：单引号？双引号</h3><p>关于字符串应该用单引号还是双引号包裹，Black 的开发组成员和一些用户有不同的意见。在早先的版本中，Black 强制使用双引号，且用户无法自行修改。于是他们足足在 Issue 里“吵”了一百多楼，各种引经据典，据理力争……终于开发组不得不妥协，勉为其难的给出了一个不格式化字符串引号的选项。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/psf/black/issues/118">GitHub 原楼请戳</a></p>
<h3 id="关于代码风格格式化的一点讨论"><a href="#关于代码风格格式化的一点讨论" class="headerlink" title="关于代码风格格式化的一点讨论"></a>关于代码风格格式化的一点讨论</h3><p>作为一个比较好学的 Python 小白，我从很早的时候就已经仔细阅读了 PEP 8，并利用 PyCharm 中自动检查规范自己的代码，深信代码首先是写给人看的，其次才是写给机器运行的。</p>
<p>在阅读 Black 文档时，我看到了这样一段话：</p>
<blockquote>
<p><strong>Pro-tip</strong>: If you’re asking yourself “Do I need to configure anything?” the answer is “No”. <em>Black</em> is all about sensible defaults. Applying those defaults will have your code in compliance with many other <em>Black</em> formatted projects.</p>
<p><strong>进阶提示</strong>：当您在问自己“我是否需要配置任何东西”时，回答是否定的。Black 的一切皆为合理的默认值。使用这些默认选项将会使您的代码符合许多其他 Black 格式的项目。</p>
</blockquote>
<p>Black 的精神似乎是 “less is more”，首先制定一套非常详细完备的标准，然后大家只需要使用该标准即可（还是傻瓜式操作），不需要也非常不建议搞“自定义”而破坏统一性。对于我这种一共也没写过几万行代码，也谈不上个人代码风格的小白是很大的福音：已经有人替我斟酌考虑好了细节，直接使用即可获得美观度一流的代码，何乐而不为呢？</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Python代码格式化工具Black（转载）</p><p><a href="https://mrcq.github.io/2022/11/10/Python/Python代码格式化工具Black/">https://mrcq.github.io/2022/11/10/Python/Python代码格式化工具Black/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Kurisu</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-11-10</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-11-10</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <a class="link-muted" rel="tag" href="/tags/Python/">Python, </a><a class="link-muted" rel="tag" href="/tags/%E5%B7%A5%E5%85%B7/">工具 </a></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/11/11/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/Go%E8%AF%AD%E8%A8%80%E7%B2%BE%E8%BF%9B%E4%B9%8B%E8%B7%AF/Go%E8%AF%AD%E8%A8%80%E6%80%9D%E7%BB%B4/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Go语言思维</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/11/07/Go/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/"><span class="level-item">垃圾回收</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="Kurisu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Kurisu</p><p class="is-size-6 is-block">水滴石穿，聚沙成塔</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">46</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">16</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">16</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/mrcq" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/mrcq"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#简介"><span class="level-left"><span class="level-item">1</span><span class="level-item">简介</span></span></a></li><li><a class="level is-mobile" href="#安装"><span class="level-left"><span class="level-item">2</span><span class="level-item">安装</span></span></a></li><li><a class="level is-mobile" href="#简单使用"><span class="level-left"><span class="level-item">3</span><span class="level-item">简单使用</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#作为脚本运行"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">作为脚本运行</span></span></a></li><li><a class="level is-mobile" href="#作为-Python-包运行"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">作为 Python 包运行</span></span></a></li><li><a class="level is-mobile" href="#跳过字符串格式化"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">跳过字符串格式化</span></span></a></li><li><a class="level is-mobile" href="#其他更多选项"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">其他更多选项</span></span></a></li></ul></li><li><a class="level is-mobile" href="#集成到-IDE-编辑器中"><span class="level-left"><span class="level-item">4</span><span class="level-item">集成到 IDE / 编辑器中</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#在-PyCahrm-中使用"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">在 PyCahrm 中使用</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#确认-Black-安装位置"><span class="level-left"><span class="level-item">4.1.1</span><span class="level-item">确认 Black 安装位置</span></span></a></li><li><a class="level is-mobile" href="#在-PyCharm-中添加外部工具"><span class="level-left"><span class="level-item">4.1.2</span><span class="level-item">在 PyCharm 中添加外部工具</span></span></a></li><li><a class="level is-mobile" href="#使用"><span class="level-left"><span class="level-item">4.1.3</span><span class="level-item">使用</span></span></a></li><li><a class="level is-mobile" href="#设置快捷键"><span class="level-left"><span class="level-item">4.1.4</span><span class="level-item">设置快捷键</span></span></a></li><li><a class="level is-mobile" href="#保存文件时自动格式化（可选）"><span class="level-left"><span class="level-item">4.1.5</span><span class="level-item">保存文件时自动格式化（可选）</span></span></a></li></ul></li><li><a class="level is-mobile" href="#在-VS-Code-中使用"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">在 VS Code 中使用</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#安装-Python-插件"><span class="level-left"><span class="level-item">4.2.1</span><span class="level-item">安装 Python 插件</span></span></a></li><li><a class="level is-mobile" href="#配置-Python-扩展"><span class="level-left"><span class="level-item">4.2.2</span><span class="level-item">配置 Python 扩展</span></span></a></li><li><a class="level is-mobile" href="#保存文件时自动格式化代码（可选）"><span class="level-left"><span class="level-item">4.2.3</span><span class="level-item">保存文件时自动格式化代码（可选）</span></span></a></li><li><a class="level is-mobile" href="#取消格式化为双引号包裹字符串（可选）"><span class="level-left"><span class="level-item">4.2.4</span><span class="level-item">取消格式化为双引号包裹字符串（可选）</span></span></a></li></ul></li><li><a class="level is-mobile" href="#使用-Black-Formatter-插件"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">使用 Black Formatter 插件</span></span></a></li><li><a class="level is-mobile" href="#在-Vim-中使用"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">在 Vim 中使用</span></span></a></li><li><a class="level is-mobile" href="#更多"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">更多</span></span></a></li></ul></li><li><a class="level is-mobile" href="#详细使用"><span class="level-left"><span class="level-item">5</span><span class="level-item">详细使用</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#命令行选项"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">命令行选项</span></span></a></li><li><a class="level is-mobile" href="#代码输入选择"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">代码输入选择</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#从标准输入读取"><span class="level-left"><span class="level-item">5.2.1</span><span class="level-item">从标准输入读取</span></span></a></li><li><a class="level is-mobile" href="#作为字符串"><span class="level-left"><span class="level-item">5.2.2</span><span class="level-item">作为字符串</span></span></a></li></ul></li><li><a class="level is-mobile" href="#写回与报告"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">写回与报告</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#退出代码"><span class="level-left"><span class="level-item">5.3.1</span><span class="level-item">退出代码</span></span></a></li><li><a class="level is-mobile" href="#差异比较"><span class="level-left"><span class="level-item">5.3.2</span><span class="level-item">差异比较</span></span></a></li></ul></li><li><a class="level is-mobile" href="#详细输出"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">详细输出</span></span></a></li><li><a class="level is-mobile" href="#版本"><span class="level-left"><span class="level-item">5.5</span><span class="level-item">版本</span></span></a></li></ul></li><li><a class="level is-mobile" href="#通过文件配置"><span class="level-left"><span class="level-item">6</span><span class="level-item">通过文件配置</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#pyproject-toml-文件"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">pyproject.toml 文件</span></span></a></li><li><a class="level is-mobile" href="#查找路径"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">查找路径</span></span></a></li><li><a class="level is-mobile" href="#配置格式"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">配置格式</span></span></a></li><li><a class="level is-mobile" href="#配置项使用层级关系"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">配置项使用层级关系</span></span></a></li></ul></li><li><a class="level is-mobile" href="#The-Black-Code-Style"><span class="level-left"><span class="level-item">7</span><span class="level-item">The Black Code Style</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#代码风格"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">代码风格</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#换行方式"><span class="level-left"><span class="level-item">7.1.1</span><span class="level-item">换行方式</span></span></a></li><li><a class="level is-mobile" href="#行长度"><span class="level-left"><span class="level-item">7.1.2</span><span class="level-item">行长度</span></span></a></li><li><a class="level is-mobile" href="#空白行"><span class="level-left"><span class="level-item">7.1.3</span><span class="level-item">空白行</span></span></a></li><li><a class="level is-mobile" href="#注释"><span class="level-left"><span class="level-item">7.1.4</span><span class="level-item">注释</span></span></a></li><li><a class="level is-mobile" href="#尾随逗号"><span class="level-left"><span class="level-item">7.1.5</span><span class="level-item">尾随逗号</span></span></a></li><li><a class="level is-mobile" href="#字符串"><span class="level-left"><span class="level-item">7.1.6</span><span class="level-item">字符串</span></span></a></li><li><a class="level is-mobile" href="#数字文字量"><span class="level-left"><span class="level-item">7.1.7</span><span class="level-item">数字文字量</span></span></a></li><li><a class="level is-mobile" href="#二元运算符与换行"><span class="level-left"><span class="level-item">7.1.8</span><span class="level-item">二元运算符与换行</span></span></a></li><li><a class="level is-mobile" href="#切片类型"><span class="level-left"><span class="level-item">7.1.9</span><span class="level-item">切片类型</span></span></a></li><li><a class="level is-mobile" href="#括号"><span class="level-left"><span class="level-item">7.1.10</span><span class="level-item">括号</span></span></a></li><li><a class="level is-mobile" href="#调用链"><span class="level-left"><span class="level-item">7.1.11</span><span class="level-item">调用链</span></span></a></li><li><a class="level is-mobile" href="#存根文件"><span class="level-left"><span class="level-item">7.1.12</span><span class="level-item">存根文件</span></span></a></li></ul></li><li><a class="level is-mobile" href="#实用主义"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">实用主义</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#神奇的尾随逗号"><span class="level-left"><span class="level-item">7.2.1</span><span class="level-item">神奇的尾随逗号</span></span></a></li><li><a class="level is-mobile" href="#r”strings”-与-R”strings”"><span class="level-left"><span class="level-item">7.2.2</span><span class="level-item">r”strings” 与 R”strings”</span></span></a></li><li><a class="level is-mobile" href="#格式化前后的-AST"><span class="level-left"><span class="level-item">7.2.3</span><span class="level-item">格式化前后的 AST</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#其他"><span class="level-left"><span class="level-item">8</span><span class="level-item">其他</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#在-README-中展示"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">在 README 中展示</span></span></a></li><li><a class="level is-mobile" href="#吃瓜：单引号？双引号"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">吃瓜：单引号？双引号</span></span></a></li><li><a class="level is-mobile" href="#关于代码风格格式化的一点讨论"><span class="level-left"><span class="level-item">8.3</span><span class="level-item">关于代码风格格式化的一点讨论</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Kurisu&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2022 Kurisu</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>